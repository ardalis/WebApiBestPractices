using JWTAPI.Core.Security.Hashing;
using JWTAPI.Persistence;

namespace JWTAPI;

public class Program
{
	public static void Main(string[] args)
	{
		var host = CreateHostBuilder(args).Build();

		using (var scope = host.Services.CreateScope())
		{
			var services = scope.ServiceProvider;
			var context = services.GetService<AppDbContext>();
			var passwordHasher = services.GetService<IPasswordHasher>();
			DatabaseSeed.Seed(context, passwordHasher);
		}

		host.Run();
	}

	public static IHostBuilder CreateHostBuilder(string[] args)
	{
		return Host.CreateDefaultBuilder(args)
				.ConfigureWebHostDefaults(webBuilder =>
				{
					webBuilder.UseStartup<Startup>();
				});
	}
}
